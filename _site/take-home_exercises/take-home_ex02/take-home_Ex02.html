<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcus Jaeson Yeo">
<meta name="dcterms.date" content="2024-09-26">

<title>IS415-GAA - Take-home Exercise 2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex01/hands-on-ex1.html">
 <span class="dropdown-text">Hands-on Exercise 1: Geospatial Data Science with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex02/hands-on-ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2: Thematic Mapping and GeoVisualisation with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex03/hands-on-ex3_p1/hands-on-ex3_p1.html">
 <span class="dropdown-text">Hands-on Exercise 3: 1st Order SPAA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex03/hands-on-ex3_p2/hands-on-ex3_p2.html">
 <span class="dropdown-text">Hands-on Exercise 3: 2nd Order SPAA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex04/in-class_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4: ICE4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex05/hands-on-ex5.html">
 <span class="dropdown-text">Hands-on Exercise 5: Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex06/hands-on-ex6_global/hands-on-ex6_global.html">
 <span class="dropdown-text">Hands-on Exercise 6: Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on-exercises/Hands-on_Ex06/hands-on-ex6_local/hands-on-ex6_local.html">
 <span class="dropdown-text">Hands-on Exercise 6: Local Measures of Spatial Autocorrelation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex01/in-class_Ex01-v2.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex02/in-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex03/in-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex04/in-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex05/in-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_exercises/in-class_ex06/in-class_Ex06.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../take-home_exercises/take-home_ex01/take-home_Ex01.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take-home_exercises/take-home_ex02/take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1.0 Introduction</a></li>
  <li><a href="#importing-packages" id="toc-importing-packages" class="nav-link" data-scroll-target="#importing-packages">2.0 Importing Packages</a></li>
  <li><a href="#importing-datasets-into-environment" id="toc-importing-datasets-into-environment" class="nav-link" data-scroll-target="#importing-datasets-into-environment">3.0 Importing Datasets into Environment</a></li>
  <li><a href="#data-wrangling-necessary-projection-transformation" id="toc-data-wrangling-necessary-projection-transformation" class="nav-link" data-scroll-target="#data-wrangling-necessary-projection-transformation">4.0 Data Wrangling + necessary Projection Transformation</a>
  <ul class="collapse">
  <li><a href="#dropping-redundant-columns-left-join" id="toc-dropping-redundant-columns-left-join" class="nav-link" data-scroll-target="#dropping-redundant-columns-left-join">4.1 Dropping redundant columns + Left Join</a></li>
  <li><a href="#dropping-and-summing-total-number-of-drug-cases" id="toc-dropping-and-summing-total-number-of-drug-cases" class="nav-link" data-scroll-target="#dropping-and-summing-total-number-of-drug-cases">4.2 Dropping and summing total number of drug cases</a></li>
  <li><a href="#projection-transformation" id="toc-projection-transformation" class="nav-link" data-scroll-target="#projection-transformation">4.3 Projection Transformation</a></li>
  </ul></li>
  <li><a href="#exploratory-spatial-data-analysis" id="toc-exploratory-spatial-data-analysis" class="nav-link" data-scroll-target="#exploratory-spatial-data-analysis">5.0 Exploratory Spatial Data Analysis</a>
  <ul class="collapse">
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting">5.1 Plotting</a></li>
  <li><a href="#total-number-of-cases-by-each-year-and-each-province" id="toc-total-number-of-cases-by-each-year-and-each-province" class="nav-link" data-scroll-target="#total-number-of-cases-by-each-year-and-each-province">5.1.1 Total number of cases by each year and each province</a></li>
  <li><a href="#top-5-provinces-with-the-highest-number-of-drug-cases-over-all-the-years" id="toc-top-5-provinces-with-the-highest-number-of-drug-cases-over-all-the-years" class="nav-link" data-scroll-target="#top-5-provinces-with-the-highest-number-of-drug-cases-over-all-the-years">5.1.2 Top 5 Provinces with the highest number of drug cases over all the years</a></li>
  <li><a href="#visualising-quantile-interval-classification-over-all-the-years" id="toc-visualising-quantile-interval-classification-over-all-the-years" class="nav-link" data-scroll-target="#visualising-quantile-interval-classification-over-all-the-years">5.1.3 Visualising Quantile Interval Classification over all the years</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">6.0 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#configuring-and-binding-coordinates" id="toc-configuring-and-binding-coordinates" class="nav-link" data-scroll-target="#configuring-and-binding-coordinates">6.1 Configuring and Binding coordinates</a></li>
  <li><a href="#computing-distance-based-neighbours" id="toc-computing-distance-based-neighbours" class="nav-link" data-scroll-target="#computing-distance-based-neighbours">6.2 Computing distance-based neighbours</a></li>
  <li><a href="#attempting-fixed-distance" id="toc-attempting-fixed-distance" class="nav-link" data-scroll-target="#attempting-fixed-distance">6.2.1 Attempting Fixed Distance</a></li>
  <li><a href="#attempting-adaptive-distance" id="toc-attempting-adaptive-distance" class="nav-link" data-scroll-target="#attempting-adaptive-distance">6.2.2 Attempting Adaptive Distance</a></li>
  <li><a href="#global-moran-i-access-spatial-autocorrelation-using-adaptive-distance" id="toc-global-moran-i-access-spatial-autocorrelation-using-adaptive-distance" class="nav-link" data-scroll-target="#global-moran-i-access-spatial-autocorrelation-using-adaptive-distance">6.2.3 Global Moran I: Access Spatial Autocorrelation using Adaptive Distance</a></li>
  <li><a href="#spatial-correlogram" id="toc-spatial-correlogram" class="nav-link" data-scroll-target="#spatial-correlogram">6.3 Spatial Correlogram</a></li>
  </ul></li>
  <li><a href="#local-measures-of-spatial-autocorrelation" id="toc-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation">7.0 Local Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#adaptive-distance-weight-matrix" id="toc-adaptive-distance-weight-matrix" class="nav-link" data-scroll-target="#adaptive-distance-weight-matrix">7.1 Adaptive Distance Weight Matrix</a></li>
  <li><a href="#lisa" id="toc-lisa" class="nav-link" data-scroll-target="#lisa">7.2 LISA</a></li>
  <li><a href="#computing-local-morans-i" id="toc-computing-local-morans-i" class="nav-link" data-scroll-target="#computing-local-morans-i">7.2.1 Computing Local Moran’s I</a></li>
  <li><a href="#mapping-local-morans-i" id="toc-mapping-local-morans-i" class="nav-link" data-scroll-target="#mapping-local-morans-i">7.2.2 Mapping local Moran’s I</a></li>
  <li><a href="#creating-lisa-cluster-map" id="toc-creating-lisa-cluster-map" class="nav-link" data-scroll-target="#creating-lisa-cluster-map">7.3 Creating LISA Cluster Map</a></li>
  <li><a href="#plotting-moran-scatterplot" id="toc-plotting-moran-scatterplot" class="nav-link" data-scroll-target="#plotting-moran-scatterplot">7.3.1 Plotting Moran scatterplot</a></li>
  <li><a href="#plotting-moran-scatterplot-with-standardized-variable" id="toc-plotting-moran-scatterplot-with-standardized-variable" class="nav-link" data-scroll-target="#plotting-moran-scatterplot-with-standardized-variable">7.3.2 Plotting Moran scatterplot with standardized variable</a></li>
  <li><a href="#lisa-map-classes" id="toc-lisa-map-classes" class="nav-link" data-scroll-target="#lisa-map-classes">7.3.3 LISA map classes</a></li>
  <li><a href="#plotting-lisa-map" id="toc-plotting-lisa-map" class="nav-link" data-scroll-target="#plotting-lisa-map">7.3.4 <strong>Plotting LISA map</strong></a></li>
  <li><a href="#computing-gi-statistics-total-cases-over-the-years" id="toc-computing-gi-statistics-total-cases-over-the-years" class="nav-link" data-scroll-target="#computing-gi-statistics-total-cases-over-the-years">7.4 Computing Gi Statistics (total cases over the years)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance" id="toc-gi-statistics-for-adaptive-distance" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance">7.4.1 Gi statistics for adaptive distance</a></li>
  <li><a href="#plotting-and-mapping-gi-values-with-adaptive-distance-weights" id="toc-plotting-and-mapping-gi-values-with-adaptive-distance-weights" class="nav-link" data-scroll-target="#plotting-and-mapping-gi-values-with-adaptive-distance-weights">7.4.2 Plotting and Mapping Gi values with adaptive distance weights</a></li>
  <li><a href="#computing-gi-statistics-total-cases-across-the-years" id="toc-computing-gi-statistics-total-cases-across-the-years" class="nav-link" data-scroll-target="#computing-gi-statistics-total-cases-across-the-years">7.5 Computing Gi Statistics (total cases across the years)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2017" id="toc-gi-statistics-for-adaptive-distance-year-2017" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2017">7.5.1 Gi statistics for adaptive distance (year 2017)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2018" id="toc-gi-statistics-for-adaptive-distance-year-2018" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2018">7.5.2 Gi statistics for adaptive distance (year 2018)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2019" id="toc-gi-statistics-for-adaptive-distance-year-2019" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2019">7.5.3 Gi statistics for adaptive distance (year 2019)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2020" id="toc-gi-statistics-for-adaptive-distance-year-2020" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2020">7.5.4 Gi statistics for adaptive distance (year 2020)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2021" id="toc-gi-statistics-for-adaptive-distance-year-2021" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2021">7.5.5 Gi statistics for adaptive distance (year 2021)</a></li>
  <li><a href="#gi-statistics-for-adaptive-distance-year-2022" id="toc-gi-statistics-for-adaptive-distance-year-2022" class="nav-link" data-scroll-target="#gi-statistics-for-adaptive-distance-year-2022">7.5.6 Gi statistics for adaptive distance (year 2022)</a></li>
  <li><a href="#interpretation-of-results" id="toc-interpretation-of-results" class="nav-link" data-scroll-target="#interpretation-of-results">7.5.7 Interpretation of results</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Marcus Jaeson Yeo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 26, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1.0 Introduction</h2>
<section id="context" class="level4">
<h4 class="anchored" data-anchor-id="context">Context:</h4>
<p>Drug abuse is associated with significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. In 2021, 1 in 17 people, aged 15–64 in the world had used a drug in the past 12 months. Notwithstanding population growth, the estimated number of drug users grew from 240 million in 2011 to 296 million in 2021.</p>
<p>The geopolitics of Thailand which is near the <a href="https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)">Golden Triangle</a> of Indochina, the largest drug production site in Asia, and the constant transportation infrastructure development made Thailand became market and transit routes for drug trafficking to the third countries.</p>
<p>In Thailand, drug abuse is one of the major social issue. There are about 2.7 million youths using drugs in Thailand. Among youths aged between 15 and 19 years, there are about 300,000 who have needs for drug treatment. Most of Thai youths involved with drugs are vocational-school students, which nearly doubles in number compared to secondary-school students.</p>
<p>Figure below shows geographic distribution of drug use cases by province and by year.</p>
</section>
<section id="objectives" class="level4">
<h4 class="anchored" data-anchor-id="objectives">Objectives:</h4>
<ul>
<li><p>if the key indicators of drug abuse of Thailand are independent from space. (spatial independent, randomly distributed) (spatial weights and applications)</p></li>
<li><p>If the indicators of drug abuse is indeed spatial dependent, then, you would like to detect where are the clusters and outliers, and the hotspots. (no need for emerging hotspots)</p></li>
<li><p>Last but not least, you are also interested to investigate how the observation above evolve over time. (no need for spatial-temporal)</p></li>
</ul>
<hr>
</section>
</section>
<section id="importing-packages" class="level2">
<h2 class="anchored" data-anchor-id="importing-packages">2.0 Importing Packages</h2>
<ul>
<li><p>sf</p></li>
<li><p>tmap</p></li>
<li><p>tidyverse</p></li>
<li><p>spdep</p></li>
<li><p>sfdep</p></li>
<li><p>dplyr</p></li>
<li><p>tidyr</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tmap, tidyverse, spdep, sfdep, dplyr, tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="importing-datasets-into-environment" class="level2">
<h2 class="anchored" data-anchor-id="importing-datasets-into-environment">3.0 Importing Datasets into Environment</h2>
<ul>
<li><p>geospatial (admin1 (province level))</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>thailand_boundary <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial/"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">layer=</span><span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\marcus159260\IS415-GAA\take-home_exercises\take-home_ex02\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(thailand_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 77 17</code></pre>
</div>
</div></li>
<li><p>aspatial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>thailand_sf <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/thai_drug_offenses_2017_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(thailand_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7392    5</code></pre>
</div>
</div></li>
</ul>
<hr>
</section>
<section id="data-wrangling-necessary-projection-transformation" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling-necessary-projection-transformation">4.0 Data Wrangling + necessary Projection Transformation</h2>
<section id="dropping-redundant-columns-left-join" class="level3">
<h3 class="anchored" data-anchor-id="dropping-redundant-columns-left-join">4.1 Dropping redundant columns + Left Join</h3>
<ul>
<li>We want to check for missing values, and spelling errors within the provinces. So we print out the unique provinces in the thailand_boundary and thailand_sf.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(thailand_boundary<span class="sc">$</span>ADM1_EN))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bangkok"                  "Samut Prakan"            
 [3] "Nonthaburi"               "Pathum Thani"            
 [5] "Phra Nakhon Si Ayutthaya" "Ang Thong"               
 [7] "Lop Buri"                 "Sing Buri"               
 [9] "Chai Nat"                 "Saraburi"                
[11] "Chon Buri"                "Rayong"                  
[13] "Chanthaburi"              "Trat"                    
[15] "Chachoengsao"             "Prachin Buri"            
[17] "Nakhon Nayok"             "Sa Kaeo"                 
[19] "Nakhon Ratchasima"        "Buri Ram"                
[21] "Surin"                    "Si Sa Ket"               
[23] "Ubon Ratchathani"         "Yasothon"                
[25] "Chaiyaphum"               "Amnat Charoen"           
[27] "Bueng Kan"                "Nong Bua Lam Phu"        
[29] "Khon Kaen"                "Udon Thani"              
[31] "Loei"                     "Nong Khai"               
[33] "Maha Sarakham"            "Roi Et"                  
[35] "Kalasin"                  "Sakon Nakhon"            
[37] "Nakhon Phanom"            "Mukdahan"                
[39] "Chiang Mai"               "Lamphun"                 
[41] "Lampang"                  "Uttaradit"               
[43] "Phrae"                    "Nan"                     
[45] "Phayao"                   "Chiang Rai"              
[47] "Mae Hong Son"             "Nakhon Sawan"            
[49] "Uthai Thani"              "Kamphaeng Phet"          
[51] "Tak"                      "Sukhothai"               
[53] "Phitsanulok"              "Phichit"                 
[55] "Phetchabun"               "Ratchaburi"              
[57] "Kanchanaburi"             "Suphan Buri"             
[59] "Nakhon Pathom"            "Samut Sakhon"            
[61] "Samut Songkhram"          "Phetchaburi"             
[63] "Prachuap Khiri Khan"      "Nakhon Si Thammarat"     
[65] "Krabi"                    "Phangnga"                
[67] "Phuket"                   "Surat Thani"             
[69] "Ranong"                   "Chumphon"                
[71] "Songkhla"                 "Satun"                   
[73] "Trang"                    "Phatthalung"             
[75] "Pattani"                  "Yala"                    
[77] "Narathiwat"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">---------------------</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
---------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(thailand_sf<span class="sc">$</span>province_en))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bangkok"                  "Chai Nat"                
 [3] "Nonthaburi"               "Pathum Thani"            
 [5] "Phra Nakhon Si Ayutthaya" "Loburi"                  
 [7] "Samut Prakan"             "Saraburi"                
 [9] "Sing Buri"                "Ang Thong"               
[11] "Chanthaburi"              "Chachoengsao"            
[13] "Chon Buri"                "Trat"                    
[15] "Nakhon Nayok"             "Prachin Buri"            
[17] "Rayong"                   "Sa Kaeo"                 
[19] "Chaiyaphum"               "Nakhon Ratchasima"       
[21] "Buri Ram"                 "Yasothon"                
[23] "Si Sa Ket"                "Surin"                   
[25] "Amnat Charoen"            "Ubon Ratchathani"        
[27] "Kalasin"                  "Khon Kaen"               
[29] "Nakhon Phanom"            "buogkan"                 
[31] "Maha Sarakham"            "Mukdahan"                
[33] "Roi Et"                   "Loei"                    
[35] "Sakon Nakhon"             "Nong Khai"               
[37] "Nong Bua Lam Phu"         "Udon Thani"              
[39] "Chiang Rai"               "Chiang Mai"              
[41] "Nan"                      "Phayao"                  
[43] "Phrae"                    "Mae Hong Son"            
[45] "Lampang"                  "Lamphun"                 
[47] "Kamphaeng Phet"           "Tak"                     
[49] "Nakhon Sawan"             "Phichit"                 
[51] "Phitsanulok"              "Phetchabun"              
[53] "Sukhothai"                "Uttaradit"               
[55] "Uthai Thani"              "Kanchanaburi"            
[57] "Nakhon Pathom"            "Prachuap Khiri Khan"     
[59] "Phetchaburi"              "Ratchaburi"              
[61] "Samut Songkhram"          "Samut Sakhon"            
[63] "Suphan Buri"              "Krabi"                   
[65] "Chumphon"                 "Nakhon Si Thammarat"     
[67] "Phangnga"                 "Phuket"                  
[69] "Ranong"                   "Surat Thani"             
[71] "Trang"                    "Narathiwat"              
[73] "Pattani"                  "Phatthalung"             
[75] "Yala"                     "Songkhla"                
[77] "Satun"                   </code></pre>
</div>
</div>
<p>Here we notice that in thailand_sf, we have the provinces: ‘Lop Buri’ and ‘Bueng Kan’ spelled wrongly, as ‘’Loburi’ and ‘buogkan’. Hence, we need to perform data transformation (renaming of the provinces) and do necessary trimming and conversion to lowercase. After which, we will perform a left join using the common identifier (province) and remove the missing values.</p>
<ul>
<li>First, we need to mutate to do the necessary data transformation</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>thailand_boundary <span class="ot">&lt;-</span> thailand_boundary <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ADM1_EN =</span> <span class="fu">str_to_lower</span>(ADM1_EN),  <span class="co"># Convert to lowercase</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ADM1_EN =</span> <span class="fu">str_trim</span>(ADM1_EN))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>thailand_sf <span class="ot">&lt;-</span> thailand_sf <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">province_en =</span> <span class="fu">str_to_lower</span>(province_en),  <span class="co"># Convert to lowercase</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">province_en =</span> <span class="fu">str_trim</span>(province_en),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">province_en =</span> <span class="fu">gsub</span>(<span class="st">"^loburi$"</span>, <span class="st">"lop buri"</span>, province_en),  <span class="co"># Rename 'loburi' to 'lop buri'</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">province_en =</span> <span class="fu">gsub</span>(<span class="st">"^buogkan$"</span>, <span class="st">"bueng kan"</span>, province_en)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(thailand_sf<span class="sc">$</span>province_en))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "bangkok"                  "chai nat"                
 [3] "nonthaburi"               "pathum thani"            
 [5] "phra nakhon si ayutthaya" "lop buri"                
 [7] "samut prakan"             "saraburi"                
 [9] "sing buri"                "ang thong"               
[11] "chanthaburi"              "chachoengsao"            
[13] "chon buri"                "trat"                    
[15] "nakhon nayok"             "prachin buri"            
[17] "rayong"                   "sa kaeo"                 
[19] "chaiyaphum"               "nakhon ratchasima"       
[21] "buri ram"                 "yasothon"                
[23] "si sa ket"                "surin"                   
[25] "amnat charoen"            "ubon ratchathani"        
[27] "kalasin"                  "khon kaen"               
[29] "nakhon phanom"            "bueng kan"               
[31] "maha sarakham"            "mukdahan"                
[33] "roi et"                   "loei"                    
[35] "sakon nakhon"             "nong khai"               
[37] "nong bua lam phu"         "udon thani"              
[39] "chiang rai"               "chiang mai"              
[41] "nan"                      "phayao"                  
[43] "phrae"                    "mae hong son"            
[45] "lampang"                  "lamphun"                 
[47] "kamphaeng phet"           "tak"                     
[49] "nakhon sawan"             "phichit"                 
[51] "phitsanulok"              "phetchabun"              
[53] "sukhothai"                "uttaradit"               
[55] "uthai thani"              "kanchanaburi"            
[57] "nakhon pathom"            "prachuap khiri khan"     
[59] "phetchaburi"              "ratchaburi"              
[61] "samut songkhram"          "samut sakhon"            
[63] "suphan buri"              "krabi"                   
[65] "chumphon"                 "nakhon si thammarat"     
[67] "phangnga"                 "phuket"                  
[69] "ranong"                   "surat thani"             
[71] "trang"                    "narathiwat"              
[73] "pattani"                  "phatthalung"             
[75] "yala"                     "songkhla"                
[77] "satun"                   </code></pre>
</div>
</div>
<p>By printing the unique thailand_sf provinces again, we get the correct names of the 2 provinces.</p>
<ul>
<li>Second, we perform a left join.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>thailand_left_join <span class="ot">&lt;-</span> thailand_boundary <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(thailand_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">3</span>, <span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>, <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>missing_provinces <span class="ot">&lt;-</span> thailand_left_join <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(no_cases)) <span class="sc">%&gt;%</span>  <span class="co"># Check for NA in the case column</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_provinces)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 1 field
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
[1] ADM1_EN  geometry
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>We see that there are no rows with missing values.</p>
</section>
<section id="dropping-and-summing-total-number-of-drug-cases" class="level3">
<h3 class="anchored" data-anchor-id="dropping-and-summing-total-number-of-drug-cases">4.2 Dropping and summing total number of drug cases</h3>
<section id="understanding-our-data" class="level4">
<h4 class="anchored" data-anchor-id="understanding-our-data">Understanding our data</h4>
<ul>
<li>unique years, types of drug offenses</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>unique_years <span class="ot">=</span> <span class="fu">unique</span>(thailand_left_join<span class="sc">$</span>fiscal_year)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>unique_types <span class="ot">=</span> <span class="fu">unique</span>(thailand_left_join<span class="sc">$</span>types_of_drug_offenses)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>unique_years</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2017 2018 2019 2020 2021 2022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>unique_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "drug_use_cases"                                        
 [2] "suspects_in_drug_use_cases"                            
 [3] "possession_cases"                                      
 [4] "suspects_in_possession_cases"                          
 [5] "possession_with_intent_to_distribute_cases"            
 [6] "suspects_in_possession_with_intent_to_distribute_cases"
 [7] "trafficking_cases"                                     
 [8] "suspects_in_trafficking_cases"                         
 [9] "production_cases"                                      
[10] "suspects_in_production_cases"                          
[11] "import_cases"                                          
[12] "suspects_in_import_cases"                              
[13] "export_cases"                                          
[14] "suspects_in_export_cases"                              
[15] "conspiracy_cases"                                      
[16] "suspects_in_conspiracy_cases"                          </code></pre>
</div>
</div>
</section>
<section id="filtering-and-data-wrangling" class="level4">
<h4 class="anchored" data-anchor-id="filtering-and-data-wrangling">Filtering and Data Wrangling</h4>
<ul>
<li>As we are only interested in drug_cases under the types_of_drug_offenses, we need to filter based on that. We need to also filter the rows where the total_cases are 0 and sort the years in ascending (2017-2022).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> thailand_left_join <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">==</span> <span class="st">"drug_use_cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(no_cases <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fiscal_year)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>thailand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 462 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84
First 10 features:
                    ADM1_EN fiscal_year types_of_drug_offenses no_cases
1                   bangkok        2017         drug_use_cases    11871
2              samut prakan        2017         drug_use_cases      820
3                nonthaburi        2017         drug_use_cases      553
4              pathum thani        2017         drug_use_cases      450
5  phra nakhon si ayutthaya        2017         drug_use_cases      378
6                 ang thong        2017         drug_use_cases      208
7                  lop buri        2017         drug_use_cases      727
8                 sing buri        2017         drug_use_cases      127
9                  chai nat        2017         drug_use_cases      200
10                 saraburi        2017         drug_use_cases       69
                         geometry
1  MULTIPOLYGON (((100.6139 13...
2  MULTIPOLYGON (((100.7306 13...
3  MULTIPOLYGON (((100.3415 14...
4  MULTIPOLYGON (((100.8916 14...
5  MULTIPOLYGON (((100.5131 14...
6  MULTIPOLYGON (((100.3332 14...
7  MULTIPOLYGON (((101.3453 15...
8  MULTIPOLYGON (((100.3691 15...
9  MULTIPOLYGON (((100.1199 15...
10 MULTIPOLYGON (((101.3994 15...</code></pre>
</div>
</div>
</section>
<section id="pivoting-the-fiscal-years-to-get-unique-polygons" class="level4">
<h4 class="anchored" data-anchor-id="pivoting-the-fiscal-years-to-get-unique-polygons">Pivoting the fiscal years to get unique Polygons</h4>
<ul>
<li>We do this because when we do polygonal rendering, there are 6 copies (years 2017-2022) of the same polygons, which will slow down the time it takes to execute the process such as the poly2nb() spatial weights when we attempt to find the neighbours of regions. Hence, we need to <strong>reshape</strong> the dataframe using pivot_wider() to <u>reduce the number of rows</u>, approximately (462/6 = 77 rows), and make the <u>geometry polygons unique</u>, while keeping our provinces unique as well. This is done by transposing the fiscal_year and no_cases to more columns by the number of cases in each year (no_cases_&lt;year&gt;).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivoting data to widen fiscal_year into separate no_cases columns by year</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_EN, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fiscal_year, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> no_cases,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">"no_cases_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_cases =</span> no_cases_2017 <span class="sc">+</span> no_cases_2018 <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     no_cases_2019 <span class="sc">+</span> no_cases_2020 <span class="sc">+</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                     no_cases_2021 <span class="sc">+</span> no_cases_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="projection-transformation" class="level3">
<h3 class="anchored" data-anchor-id="projection-transformation">4.3 Projection Transformation</h3>
<p>Since the EPSG code is 4326, which is the global code. We want to change both the EPSG code of the boundary data and working data to Thailand’s global projection system. Acquiring the code from <a href="https://epsg.io/32647" class="uri">https://epsg.io/32647</a></p>
<ul>
<li>We will transform the it to Thailand’s projected coordinate system (UTM Zone 47N) with the EPSG code: 32647</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(thailand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="plotting-the-basemap-object-to-visualise-structure-with-provinces" class="level4">
<h4 class="anchored" data-anchor-id="plotting-the-basemap-object-to-visualise-structure-with-provinces">4.3 Plotting the basemap object to visualise structure with provinces</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-width: 12</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-height: 10</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>basemap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size=</span><span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Basemap with provinces"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>basemap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="writing-and-reading-into-rds-format" class="level4">
<h4 class="anchored" data-anchor-id="writing-and-reading-into-rds-format">4.4 Writing and Reading into RDS format</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#thailand combined dataframe</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(thailand, <span class="st">"data/rds/thailand.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/thailand.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
</section>
<section id="exploratory-spatial-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-spatial-data-analysis">5.0 Exploratory Spatial Data Analysis</h2>
<ul>
<li>min and max total no of drug cases</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>min_cases <span class="ot">=</span> <span class="fu">min</span>(thailand<span class="sc">$</span>total_cases, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>max_cases <span class="ot">=</span> <span class="fu">max</span>(thailand<span class="sc">$</span>total_cases, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>min_cases</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1426</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>max_cases</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 65522</code></pre>
</div>
</div>
<section id="plotting" class="level3">
<h3 class="anchored" data-anchor-id="plotting">5.1 Plotting</h3>
</section>
<section id="total-number-of-cases-by-each-year-and-each-province" class="level3">
<h3 class="anchored" data-anchor-id="total-number-of-cases-by-each-year-and-each-province">5.1.1 Total number of cases by each year and each province</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>min_cases <span class="ot">&lt;-</span> <span class="fu">min</span>(thailand<span class="sc">$</span>no_cases_2017, thailand<span class="sc">$</span>no_cases_2018, thailand<span class="sc">$</span>no_cases_2019, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                 thailand<span class="sc">$</span>no_cases_2020, thailand<span class="sc">$</span>no_cases_2021, thailand<span class="sc">$</span>no_cases_2022, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>max_cases <span class="ot">&lt;-</span> <span class="fu">max</span>(thailand<span class="sc">$</span>no_cases_2017, thailand<span class="sc">$</span>no_cases_2018, thailand<span class="sc">$</span>no_cases_2019, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                 thailand<span class="sc">$</span>no_cases_2020, thailand<span class="sc">$</span>no_cases_2021, thailand<span class="sc">$</span>no_cases_2022, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom breaks based on the range</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>custom_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(min_cases, max_cases, <span class="at">length.out =</span> <span class="dv">5</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2017</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plot_2017 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2017"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2017)"</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2017"</span>,  </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,     <span class="co"># Smaller title size</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>,  <span class="co"># Legend outside the map area</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">TRUE</span>)  <span class="co"># Show legend for only this plot</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2018</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>plot_2018 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2018"</span>,</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2018)"</span>) <span class="sc">+</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2018"</span>,  </span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,    </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>)  <span class="co"># Hide legend</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2019</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>plot_2019 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2019"</span>,</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2019)"</span>) <span class="sc">+</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2019"</span>,  </span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,     </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>)  <span class="co"># Hide legend</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2020</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>plot_2020 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2020"</span>,</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2020)"</span>) <span class="sc">+</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2020"</span>,  </span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,     </span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>)  <span class="co"># Hide legend</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2021</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>plot_2021 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2021"</span>,</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2021)"</span>) <span class="sc">+</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2021"</span>,  </span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,     </span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>)  <span class="co"># Hide legend</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for 2022</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>plot_2022 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"no_cases_2022"</span>,</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> custom_breaks, </span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Drug Cases (2022)"</span>) <span class="sc">+</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"2022"</span>,  </span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,     </span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">0.8</span>,              </span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>)  <span class="co"># Hide legend</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange all plots side by side in a grid with one legend</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(plot_2017, plot_2018, plot_2019, plot_2020, plot_2021, plot_2022, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. The labels have been resized to 0.29, 0.23, 0.21, 0.19. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-5-provinces-with-the-highest-number-of-drug-cases-over-all-the-years" class="level3">
<h3 class="anchored" data-anchor-id="top-5-provinces-with-the-highest-number-of-drug-cases-over-all-the-years">5.1.2 Top 5 Provinces with the highest number of drug cases over all the years</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the top 5 provinces with the highest total cases</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>top_5_provinces <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)  <span class="co"># Select the top 5 rows</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Highlight the top 5 provinces</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>provinces <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply custom breaks to the total_cases plot</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>total_cases <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> custom_breaks,  <span class="co"># Apply the custom breaks</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>,        <span class="co"># Color palette</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Highlight the top 5 provinces on the same plot</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>highlight_top_5 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(top_5_provinces) <span class="sc">+</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Use red borders to highlight</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"black"</span>)  <span class="co"># Optional: Label them</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Arrange the plots</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(provinces, total_cases <span class="sc">+</span> highlight_top_5, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values have found that are higher than the highest break</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualising-quantile-interval-classification-over-all-the-years" class="level3">
<h3 class="anchored" data-anchor-id="visualising-quantile-interval-classification-over-all-the-years">5.1.3 Visualising Quantile Interval Classification over all the years</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-width: 15</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-height: 12</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">n=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Quantile interval classification"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"Center"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.8</span>,  <span class="co"># Reduce the title size</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.5</span>,   <span class="co"># Reduce the text size</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>))</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>quantile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some legend labels were too wide. These labels have been resized to 0.44, 0.41, 0.41, 0.41, 0.41. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation">6.0 Global Measures of Spatial Autocorrelation</h2>
<ul>
<li>If we attempt to use contiguity-based spatial weights to find neighbours, and use the queen method, we come up with a region that is not linked to any neighbours, which is incorrect.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(thailand, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">queen =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in poly2nb(thailand, queen = TRUE): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in poly2nb(thailand, queen = TRUE): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
14 with 1 link
2 most connected regions:
29 51 with 9 links</code></pre>
</div>
</div>
<p>Lets print out the region with the 0 link. It turns out to be “Phuket”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>thailand<span class="sc">$</span>ADM1_EN[<span class="dv">65</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "krabi"</code></pre>
</div>
</div>
<p>Hence, instead of using contiguity-based methods to find neighbours, we need to swap to using distance-based methods instead to find neighbours and do our global spatial autocorrelation.</p>
<section id="configuring-and-binding-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="configuring-and-binding-coordinates">6.1 Configuring and Binding coordinates</h3>
<section id="computing-longitude-and-latitude-to-achieve-coordinates" class="level4">
<h4 class="anchored" data-anchor-id="computing-longitude-and-latitude-to-achieve-coordinates">Computing longitude and latitude to achieve coordinates</h4>
<ul>
<li>longitude</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>latitude</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>bind the coordinates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude latitude
[1,]  675514.6  1523087
[2,]  685033.7  1503755
[3,]  650477.2  1539777
[4,]  681656.0  1555581
[5,]  664627.1  1586462
[6,]  645239.0  1617118</code></pre>
</div>
</div>
</section>
</section>
<section id="computing-distance-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="computing-distance-based-neighbours">6.2 Computing distance-based neighbours</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in knn2nb(knearneigh(coords)): neighbour object has 19 sub-graphs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  21548   51966   64530   63281   76823  110987 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This summary report shows that the largest first nearest neighbour distance is 110987 meters (UTM). As dnearneigh accepts meters and we need specify longlat = FALSE, lets round it up to 111000 meters and use this as our upper threshold will ensure us that all regions will at least have 1 neighbour.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section id="attempting-fixed-distance" class="level3">
<h3 class="anchored" data-anchor-id="attempting-fixed-distance">6.2.1 Attempting Fixed Distance</h3>
<ul>
<li>within 111000 meters radius</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>wm_d111000 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">111000</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dnearneigh(coords, 0, 111000, longlat = FALSE): neighbour object has
2 sub-graphs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>wm_d111000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 350 
Percentage nonzero weights: 5.903188 
Average number of links: 4.545455 
2 disjoint connected subgraphs</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(thailand<span class="sc">$</span>ADM1_EN, <span class="fu">card</span>(wm_d111000))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          
                           1 2 3 4 5 6 7 8 9 10 11 12 13 14
  amnat charoen            0 0 0 1 0 0 0 0 0  0  0  0  0  0
  ang thong                0 0 0 0 0 0 0 0 0  0  1  0  0  0
  bangkok                  0 0 0 0 0 0 0 0 0  0  0  1  0  0
  bueng kan                0 1 0 0 0 0 0 0 0  0  0  0  0  0
  buri ram                 0 1 0 0 0 0 0 0 0  0  0  0  0  0
  chachoengsao             0 0 0 0 0 0 0 0 1  0  0  0  0  0
  chai nat                 0 0 0 0 0 0 1 0 0  0  0  0  0  0
  chaiyaphum               0 1 0 0 0 0 0 0 0  0  0  0  0  0
  chanthaburi              0 0 0 0 1 0 0 0 0  0  0  0  0  0
  chiang mai               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  chiang rai               1 0 0 0 0 0 0 0 0  0  0  0  0  0
  chon buri                0 0 0 0 0 1 0 0 0  0  0  0  0  0
  chumphon                 1 0 0 0 0 0 0 0 0  0  0  0  0  0
  kalasin                  0 0 0 1 0 0 0 0 0  0  0  0  0  0
  kamphaeng phet           0 0 0 0 1 0 0 0 0  0  0  0  0  0
  kanchanaburi             0 1 0 0 0 0 0 0 0  0  0  0  0  0
  khon kaen                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  krabi                    0 0 0 0 1 0 0 0 0  0  0  0  0  0
  lampang                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  lamphun                  0 1 0 0 0 0 0 0 0  0  0  0  0  0
  loei                     1 0 0 0 0 0 0 0 0  0  0  0  0  0
  lop buri                 0 0 0 0 0 0 1 0 0  0  0  0  0  0
  mae hong son             1 0 0 0 0 0 0 0 0  0  0  0  0  0
  maha sarakham            0 0 1 0 0 0 0 0 0  0  0  0  0  0
  mukdahan                 0 0 0 0 1 0 0 0 0  0  0  0  0  0
  nakhon nayok             0 0 0 0 0 0 0 0 0  1  0  0  0  0
  nakhon pathom            0 0 0 0 0 0 0 0 0  1  0  0  0  0
  nakhon phanom            0 1 0 0 0 0 0 0 0  0  0  0  0  0
  nakhon ratchasima        1 0 0 0 0 0 0 0 0  0  0  0  0  0
  nakhon sawan             0 0 0 0 0 1 0 0 0  0  0  0  0  0
  nakhon si thammarat      0 0 0 1 0 0 0 0 0  0  0  0  0  0
  nan                      0 1 0 0 0 0 0 0 0  0  0  0  0  0
  narathiwat               0 1 0 0 0 0 0 0 0  0  0  0  0  0
  nong bua lam phu         0 0 0 1 0 0 0 0 0  0  0  0  0  0
  nong khai                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  nonthaburi               0 0 0 0 0 0 0 0 0  0  0  0  1  0
  pathum thani             0 0 0 0 0 0 0 0 0  0  0  0  0  1
  pattani                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  phangnga                 0 0 1 0 0 0 0 0 0  0  0  0  0  0
  phatthalung              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  phayao                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  phetchabun               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  phetchaburi              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  phichit                  0 0 0 1 0 0 0 0 0  0  0  0  0  0
  phitsanulok              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  phra nakhon si ayutthaya 0 0 0 0 0 0 0 0 0  0  0  0  1  0
  phrae                    0 0 0 1 0 0 0 0 0  0  0  0  0  0
  phuket                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  prachin buri             0 0 0 0 0 1 0 0 0  0  0  0  0  0
  prachuap khiri khan      1 0 0 0 0 0 0 0 0  0  0  0  0  0
  ranong                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  ratchaburi               0 0 0 0 1 0 0 0 0  0  0  0  0  0
  rayong                   0 0 1 0 0 0 0 0 0  0  0  0  0  0
  roi et                   0 0 0 0 1 0 0 0 0  0  0  0  0  0
  sa kaeo                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  sakon nakhon             0 0 0 1 0 0 0 0 0  0  0  0  0  0
  samut prakan             0 0 0 0 0 0 0 0 0  1  0  0  0  0
  samut sakhon             0 0 0 0 0 0 0 0 1  0  0  0  0  0
  samut songkhram          0 0 0 0 0 0 0 1 0  0  0  0  0  0
  saraburi                 0 0 0 0 0 0 0 0 1  0  0  0  0  0
  satun                    0 0 1 0 0 0 0 0 0  0  0  0  0  0
  si sa ket                0 1 0 0 0 0 0 0 0  0  0  0  0  0
  sing buri                0 0 0 0 0 0 0 0 0  1  0  0  0  0
  songkhla                 0 0 1 0 0 0 0 0 0  0  0  0  0  0
  sukhothai                0 0 0 1 0 0 0 0 0  0  0  0  0  0
  suphan buri              0 0 0 0 0 0 0 0 1  0  0  0  0  0
  surat thani              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  surin                    0 1 0 0 0 0 0 0 0  0  0  0  0  0
  tak                      1 0 0 0 0 0 0 0 0  0  0  0  0  0
  trang                    0 0 0 1 0 0 0 0 0  0  0  0  0  0
  trat                     1 0 0 0 0 0 0 0 0  0  0  0  0  0
  ubon ratchathani         0 1 0 0 0 0 0 0 0  0  0  0  0  0
  udon thani               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  uthai thani              0 0 0 0 0 1 0 0 0  0  0  0  0  0
  uttaradit                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  yala                     0 1 0 0 0 0 0 0 0  0  0  0  0  0
  yasothon                 0 0 1 0 0 0 0 0 0  0  0  0  0  0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>n_comp <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(wm_d111000)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>n_comp<span class="sc">$</span>nc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<ul>
<li>This shows that there are 2 disjoined subgraphs, meaning that there are two distinct groups that are not connected each other. Below shows that the first subgraph contains 61 regions, while the second subgraph contains 14 regions.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2 
63 14 </code></pre>
</div>
</div>
<section id="plotting-fixed-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="plotting-fixed-distance-weight-matrix">Plotting fixed distance weight matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the boundary and neighborhood structures with adjusted limits</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(thailand<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d111000, coords, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1, coords, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">length=</span><span class="fl">0.08</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot 1st nearest neighbours (red lines) vs Distance link of neighbours within the cut-off distance of 111000 meters (black lines)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(thailand<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"1st nearest neighbours"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1, coords, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">length=</span><span class="fl">0.08</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(thailand<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"Distance link"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d111000, coords, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="attempting-adaptive-distance" class="level3">
<h3 class="anchored" data-anchor-id="attempting-adaptive-distance">6.2.2 Attempting Adaptive Distance</h3>
<section id="computing-adaptive-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="computing-adaptive-distance-weight-matrix">Computing Adaptive Distance Weight matrix</h4>
<ul>
<li>Lets fix k=6, and no go too far ahead as greater the k, the further the search of neighbours would be.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>knn6 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k=</span><span class="dv">6</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>knn6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 462 
Percentage nonzero weights: 7.792208 
Average number of links: 6 
Non-symmetric neighbours list</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(knn6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 77
 $ : int [1:6] 2 3 4 5 59 60
 $ : int [1:6] 1 3 4 11 59 60
 $ : int [1:6] 1 2 4 5 59 60
 $ : int [1:6] 1 2 3 5 17 59
 $ : int [1:6] 1 3 4 6 10 59
 $ : int [1:6] 4 5 8 9 10 58
 $ : int [1:6] 5 6 8 9 10 17
 $ : int [1:6] 5 6 7 9 10 58
 $ : int [1:6] 6 7 8 48 49 58
 $ : int [1:6] 4 5 6 7 8 17
 $ : int [1:6] 1 2 12 13 15 16
 $ : int [1:6] 1 2 11 13 14 15
 $ : int [1:6] 11 12 14 15 16 18
 $ : int [1:6] 11 12 13 15 16 18
 $ : int [1:6] 1 2 11 12 16 17
 $ : int [1:6] 4 10 11 15 17 18
 $ : int [1:6] 1 4 5 10 15 16
 $ : int [1:6] 13 15 16 17 19 20
 $ : int [1:6] 7 10 16 17 20 25
 $ : int [1:6] 18 19 21 22 33 34
 $ : int [1:6] 20 22 23 24 33 34
 $ : int [1:6] 20 21 23 24 26 34
 $ : int [1:6] 21 22 24 26 34 38
 $ : int [1:6] 22 23 26 34 35 38
 $ : int [1:6] 7 19 28 29 33 55
 $ : int [1:6] 22 23 24 34 35 38
 $ : int [1:6] 28 30 32 35 36 37
 $ : int [1:6] 25 29 30 31 32 35
 $ : int [1:6] 25 28 30 33 34 35
 $ : int [1:6] 27 28 29 32 35 36
 $ : int [1:6] 28 30 32 42 53 55
 $ : int [1:6] 27 28 30 31 35 36
 $ : int [1:6] 20 21 24 29 34 35
 $ : int [1:6] 21 24 26 33 35 38
 $ : int [1:6] 24 29 33 34 36 38
 $ : int [1:6] 27 30 32 35 37 38
 $ : int [1:6] 24 27 30 35 36 38
 $ : int [1:6] 24 26 34 35 36 37
 $ : int [1:6] 40 41 43 45 46 47
 $ : int [1:6] 39 41 43 47 51 52
 $ : int [1:6] 39 40 42 43 45 52
 $ : int [1:6] 31 41 43 44 52 53
 $ : int [1:6] 40 41 42 44 45 52
 $ : int [1:6] 31 41 42 43 45 46
 $ : int [1:6] 39 41 42 43 44 46
 $ : int [1:6] 39 40 41 43 44 45
 $ : int [1:6] 39 40 41 43 45 46
 $ : int [1:6] 7 8 9 49 50 54
 $ : int [1:6] 8 9 48 50 57 58
 $ : int [1:6] 48 49 51 52 53 54
 $ : int [1:6] 40 48 49 50 52 54
 $ : int [1:6] 41 42 43 50 51 53
 $ : int [1:6] 31 42 50 52 54 55
 $ : int [1:6] 9 48 50 52 53 55
 $ : int [1:6] 7 25 31 48 53 54
 $ : int [1:6] 1 3 59 60 61 62
 $ : int [1:6] 6 9 49 56 58 59
 $ : int [1:6] 5 6 8 9 57 59
 $ : int [1:6] 1 3 4 5 60 61
 $ : int [1:6] 1 2 3 56 59 61
 $ : int [1:6] 1 3 56 59 60 62
 $ : int [1:6] 3 56 59 60 61 63
 $ : int [1:6] 2 56 60 61 62 70
 $ : int [1:6] 65 66 67 68 73 74
 $ : int [1:6] 64 66 67 68 73 74
 $ : int [1:6] 64 65 67 68 69 73
 $ : int [1:6] 64 65 66 68 73 74
 $ : int [1:6] 64 65 66 67 69 70
 $ : int [1:6] 64 65 66 67 68 70
 $ : int [1:6] 63 64 65 66 68 69
 $ : int [1:6] 72 73 74 75 76 77
 $ : int [1:6] 64 71 73 74 75 76
 $ : int [1:6] 64 65 67 71 72 74
 $ : int [1:6] 64 65 71 72 73 75
 $ : int [1:6] 71 72 73 74 76 77
 $ : int [1:6] 71 72 73 74 75 77
 $ : int [1:6] 71 72 73 74 75 76
 - attr(*, "region.id")= chr [1:77] "1" "2" "3" "4" ...
 - attr(*, "call")= language knearneigh(x = coords, k = 6)
 - attr(*, "sym")= logi FALSE
 - attr(*, "type")= chr "knn"
 - attr(*, "knn-k")= num 6
 - attr(*, "class")= chr "nb"
 - attr(*, "ncomp")=List of 2
  ..$ nc     : int 1
  ..$ comp.id: int [1:77] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(thailand<span class="sc">$</span>ADM1_EN, <span class="fu">card</span>(knn6))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          
                           6
  amnat charoen            1
  ang thong                1
  bangkok                  1
  bueng kan                1
  buri ram                 1
  chachoengsao             1
  chai nat                 1
  chaiyaphum               1
  chanthaburi              1
  chiang mai               1
  chiang rai               1
  chon buri                1
  chumphon                 1
  kalasin                  1
  kamphaeng phet           1
  kanchanaburi             1
  khon kaen                1
  krabi                    1
  lampang                  1
  lamphun                  1
  loei                     1
  lop buri                 1
  mae hong son             1
  maha sarakham            1
  mukdahan                 1
  nakhon nayok             1
  nakhon pathom            1
  nakhon phanom            1
  nakhon ratchasima        1
  nakhon sawan             1
  nakhon si thammarat      1
  nan                      1
  narathiwat               1
  nong bua lam phu         1
  nong khai                1
  nonthaburi               1
  pathum thani             1
  pattani                  1
  phangnga                 1
  phatthalung              1
  phayao                   1
  phetchabun               1
  phetchaburi              1
  phichit                  1
  phitsanulok              1
  phra nakhon si ayutthaya 1
  phrae                    1
  phuket                   1
  prachin buri             1
  prachuap khiri khan      1
  ranong                   1
  ratchaburi               1
  rayong                   1
  roi et                   1
  sa kaeo                  1
  sakon nakhon             1
  samut prakan             1
  samut sakhon             1
  samut songkhram          1
  saraburi                 1
  satun                    1
  si sa ket                1
  sing buri                1
  songkhla                 1
  sukhothai                1
  suphan buri              1
  surat thani              1
  surin                    1
  tak                      1
  trang                    1
  trat                     1
  ubon ratchathani         1
  udon thani               1
  uthai thani              1
  uttaradit                1
  yala                     1
  yasothon                 1</code></pre>
</div>
</div>
</section>
<section id="plotting-adaptive-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="plotting-adaptive-distance-weight-matrix">Plotting adaptive distance weight matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(thailand<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn6, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p><u><strong>Decision:</strong></u></p>
<p>We find that due to the result of 2 disjointed subgraphs in fixed distance, fixed distance method is not very good because the regions should have at least a link to each other, not separation or disjoint. From the adaptive distance plot, we can see that there is no disjoint in the neighbour links, deeming adaptive distance the more suitable method to use. We shall use adaptive distance for the rest, even for local spatial autocorrelation.</p>
</section>
</section>
<section id="global-moran-i-access-spatial-autocorrelation-using-adaptive-distance" class="level3">
<h3 class="anchored" data-anchor-id="global-moran-i-access-spatial-autocorrelation-using-adaptive-distance">6.2.3 Global Moran I: Access Spatial Autocorrelation using Adaptive Distance</h3>
<p>Next, <em>nb2listw()</em> is used to convert the nb object into spatial weights object.</p>
<p>We should also fix our style=“w”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>rsknn6 <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(knn6, </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">style=</span><span class="st">"W"</span>, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>rsknn6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 462 
Percentage nonzero weights: 7.792208 
Average number of links: 6 
Non-symmetric neighbours list

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 77 5929 77 22.77778 319.6111</code></pre>
</div>
</div>
<section id="global-morans-i-test" class="level4">
<h4 class="anchored" data-anchor-id="global-morans-i-test">1. Global Moran’s I Test</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(thailand<span class="sc">$</span>total_cases, </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span>rsknn6, </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  thailand$total_cases  
weights: rsknn6    

Moran I statistic standard deviate = 1.5743, p-value = 0.0577
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.073698166      -0.013157895       0.003043706 </code></pre>
</div>
</div>
</section>
<section id="computing-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="computing-monte-carlo-morans-i">2. .Computing Monte Carlo Moran’s I</h4>
<ul>
<li><p>set a seed of 1234</p></li>
<li><p>number of simulations = 1000</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>bperm_moran<span class="ot">=</span> <span class="fu">moran.mc</span>(thailand<span class="sc">$</span>total_cases, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rsknn6, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>bperm_moran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  thailand$total_cases 
weights: rsknn6  
number of simulations + 1: 1000 

statistic = 0.073698, observed rank = 929, p-value = 0.071
alternative hypothesis: greater</code></pre>
</div>
</div>
<ul>
<li><p>moran I statistic: ~0.073698 &gt; 0 show signs of clustering, but very weak clustering due to the value being close to 0</p></li>
<li><p>p-value = 0.071 &gt; 0.05, at the 95% confidence interval, we fail to reject the null hypothesis (which assumes spatial randomness), meaning to say that we do not have enough evidence to conclude that there is significant spatial autocorrelation and clustering.</p></li>
</ul>
<p>Hence, we accept null hypothesis (h0), and conclude that the result is not statistically significant, suggesting that the observed spatial pattern could be due to spatial randomness.</p>
</section>
<section id="visualising-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualising-monte-carlo-morans-i">3. Visualising Monte Carlo Moran’s I</h4>
<ul>
<li>Computing some basic statistics</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compute mean</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bperm_moran<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01095167</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compute variance</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(bperm_moran<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002998107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary bperm</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm_moran<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.14696 -0.05032 -0.01497 -0.01095  0.02279  0.23360 </code></pre>
</div>
</div>
<ul>
<li>plotting histogram using ggplot2</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">simulated_morans_i =</span> bperm_moran<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> simulated_morans_i)) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> (<span class="fu">max</span>(data<span class="sc">$</span>simulated_morans_i) <span class="sc">-</span> <span class="fu">min</span>(data<span class="sc">$</span>simulated_morans_i)) <span class="sc">/</span> <span class="dv">20</span>, </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>) <span class="sc">+</span>  <span class="co"># Histogram</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span>  <span class="co"># Vertical line at x=0</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Simulated Moran's I"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span>  <span class="co"># Labels for x and y axis</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># Clean minimal theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="spatial-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="spatial-correlogram">6.3 Spatial Correlogram</h3>
<section id="compute-morans-i-spatial-correlogram" class="level4">
<h4 class="anchored" data-anchor-id="compute-morans-i-spatial-correlogram">Compute Moran’s I Spatial Correlogram</h4>
<p>In the code chunk below,&nbsp;<a href="https://r-spatial.github.io/spdep/reference/sp.correlogram.html"><code>sp.correlogram()</code></a>&nbsp;of&nbsp;<strong>spdep</strong>&nbsp;package is used to compute a <u><strong>6-lag</strong></u> spatial correlogram of GDPPC. The global spatial autocorrelation used in Moran’s I. The&nbsp;<strong>plot()</strong>&nbsp;of base Graph is then used to plot the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>MI_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(knn6,                            </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                          thailand<span class="sc">$</span>total_cases,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">6</span>,  <span class="co">#lag-value: 6                           </span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"I"</span>,                            </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">zero.policy =</span> <span class="cn">TRUE</span>) </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Looking at the first lag, it is positive, showing signs of clustering. This suggests that the the key indicators of drug abuse of Thailand have positive spatial dependence. The following lags after shows negative Moran I, showing signs of regular patterns amongst 2nd order neighbours and below.</li>
</ul>
<p>By plotting the output might not allow us to provide complete interpretation. This is because not all autocorrelation values are statistically significant. Hence, it is important for us to examine the full analysis report by printing out the analysis results as in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for thailand$total_cases 
method: Moran's I
         estimate expectation   variance standard deviate Pr(I) two sided
1 (77)  0.0736982  -0.0131579  0.0030437           1.5743          0.1154
2 (77) -0.0485529  -0.0131579  0.0022589          -0.7447          0.4564
3 (77) -0.0142061  -0.0131579  0.0020854          -0.0230          0.9817
4 (77) -0.0494381  -0.0131579  0.0018936          -0.8337          0.4044
5 (77)  0.0207240  -0.0131579  0.0017957           0.7996          0.4240
6 (77) -0.0590698  -0.0131579  0.0017343          -1.1025          0.2703</code></pre>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="local-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="local-measures-of-spatial-autocorrelation">7.0 Local Measures of Spatial Autocorrelation</h2>
<p>Simiarly, due to the non-linked region (i.e Phuket), we cannot use Queen and Rook methods to access local spatial autocorrelation, as it may lead to inaccuracies in the analysis. We need to use fixed-distance and adaptive-distance based methods for more reliable results.</p>
<p>We will detect the clusters, outliers, and hotspots using</p>
<ul>
<li><p><em>Getis-Ord G (Gi) Statistics:</em> Detect hotspots</p>
<ul>
<li><p>Deriving spatial weight matrix</p></li>
<li><p>Computing Gi statistics</p></li>
<li><p>Mapping Gi statistics</p></li>
</ul></li>
<li><p>Local Moran’s I: Detect local clusters (high-high and low-low) and local outliers (high-low, low-high)</p></li>
</ul>
<section id="adaptive-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="adaptive-distance-weight-matrix">7.1 Adaptive Distance Weight Matrix</h3>
<ul>
<li>stick to k=6, style=‘W’</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>knn8 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k=</span><span class="dv">6</span>))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>knn8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 462 
Percentage nonzero weights: 7.792208 
Average number of links: 6 
Non-symmetric neighbours list</code></pre>
</div>
</div>
<p>Next,&nbsp;<em>nb2listw()</em>&nbsp;is used to convert the nb object into spatial weights object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>knn8_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(knn8, <span class="at">style =</span> <span class="st">'W'</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(knn8_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 462 
Percentage nonzero weights: 7.792208 
Average number of links: 6 
Non-symmetric neighbours list
Link number distribution:

 6 
77 
77 least connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 6 links
77 most connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 6 links

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 77 5929 77 22.77778 319.6111</code></pre>
</div>
</div>
<p>Here, we can see that all 77 provinces have exactly 6 links, and province like Phuket are not left behind.</p>
</section>
<section id="lisa" class="level3">
<h3 class="anchored" data-anchor-id="lisa">7.2 LISA</h3>
</section>
<section id="computing-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="computing-local-morans-i">7.2.1 Computing Local Moran’s I</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(thailand<span class="sc">$</span>ADM1_EN)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(thailand<span class="sc">$</span>total_cases, knn8_lw)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Ii          E.Ii      Var.Ii      Z.Ii Pr(z != E(Ii))
1 -1.3015443 -0.3651782771 2.776725612 -0.561926    0.574166405
2  0.3004593 -0.0010175142 0.012175158  2.732226    0.006290797
3 -0.2010533 -0.0011494693 0.013752262 -1.704646    0.088260552
4 -0.1609904 -0.0005519039 0.006606934 -1.973825    0.048401614
5 -0.1661416 -0.0012279308 0.014689822 -1.360656    0.173622462
6  0.4667526 -0.0089644598 0.106411755  1.458324    0.144751391</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printCoefmat</span>(<span class="fu">data.frame</span>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  localMI[fips,], </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names=</span>thailand<span class="sc">$</span>ADM1_EN[fips]),</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  Ii        E.Ii      Var.Ii        Z.Ii
amnat charoen            -1.1372e-02 -4.8269e-06  5.7815e-05 -1.4950e+00
ang thong                 4.6675e-01 -8.9645e-03  1.0641e-01  1.4583e+00
bangkok                  -1.3015e+00 -3.6518e-01  2.7767e+00 -5.6193e-01
bueng kan                 6.3042e-02 -1.1191e-03  1.3389e-02  5.5449e-01
buri ram                  1.3196e-01 -2.4624e-03  2.9421e-02  7.8366e-01
chachoengsao              5.3725e-01 -1.6692e-03  1.9960e-02  3.8145e+00
chai nat                  5.1538e-01 -8.3481e-03  9.9157e-02  1.6632e+00
chaiyaphum                4.4100e-02 -3.9346e-03  4.6942e-02  2.2170e-01
chanthaburi              -1.2632e-01 -7.5399e-04  9.0243e-03 -1.3218e+00
chiang mai               -2.5498e-02 -5.7984e-02  6.5425e-01  4.0163e-02
chiang rai                3.0720e-01 -1.3157e-02  1.5552e-01  8.1235e-01
chon buri                 3.0253e+00 -9.3769e-02  1.0178e+00  3.0916e+00
chumphon                 -2.3552e-02 -2.6214e-03  3.1316e-02 -1.1828e-01
kalasin                  -4.3301e-03 -1.5286e-05  1.8309e-04 -3.1889e-01
kamphaeng phet            3.4076e-01 -3.5622e-03  4.2515e-02  1.6699e+00
kanchanaburi              8.7815e-02 -6.2682e-04  7.5032e-03  1.0210e+00
khon kaen                -9.4015e-02 -2.0313e-02  2.3836e-01 -1.5096e-01
krabi                    -1.6634e-01 -8.8645e-03  1.0524e-01 -4.8545e-01
lampang                   1.1457e-02 -3.7910e-04  4.5390e-03  1.7569e-01
lamphun                  -9.6747e-06 -9.1724e-05  1.0985e-03  2.4755e-03
loei                      1.2474e-01 -1.7465e-03  2.0883e-02  8.7530e-01
lop buri                  1.6923e-01 -8.9424e-04  1.0701e-02  1.6446e+00
mae hong son             -4.9464e-01 -1.2777e-02  1.5109e-01 -1.2397e+00
maha sarakham            -1.6152e-01 -2.7098e-03  3.2370e-02 -8.8268e-01
mukdahan                 -2.9118e-03 -2.8646e-05  3.4311e-04 -1.5565e-01
nakhon nayok             -2.1354e-01 -1.2004e-03  1.4361e-02 -1.7719e+00
nakhon pathom             3.0348e-02 -7.0656e-05  8.4624e-04  1.0457e+00
nakhon phanom             1.0451e-02 -8.1006e-04  9.6949e-03  1.1437e-01
nakhon ratchasima        -9.6004e-02 -2.1035e-02  2.4666e-01 -1.5095e-01
nakhon sawan              4.2504e-01 -5.2866e-03  6.2987e-02  1.7146e+00
nakhon si thammarat      -7.3467e-01 -6.9993e-02  7.7968e-01 -7.5275e-01
nan                      -2.8720e-04 -3.7384e-04  4.4761e-03  1.2949e-03
narathiwat                1.2254e-01 -3.5783e-03  4.2707e-02  6.1027e-01
nong bua lam phu         -2.8027e-01 -1.2094e-02  1.4310e-01 -7.0892e-01
nong khai                -2.7101e-02 -1.0793e-04  1.2926e-03 -7.5079e-01
nonthaburi               -2.0105e-01 -1.1495e-03  1.3752e-02 -1.7046e+00
pathum thani             -1.6099e-01 -5.5190e-04  6.6069e-03 -1.9738e+00
pattani                   1.1320e-01 -2.8128e-03  3.3597e-02  6.3293e-01
phangnga                 -1.0380e-01 -5.0293e-03  5.9937e-02 -4.0343e-01
phatthalung              -2.2521e-01 -7.6509e-03  9.0940e-02 -7.2144e-01
phayao                   -6.8415e-02 -3.6303e-04  4.3467e-03 -1.0322e+00
phetchabun                1.1098e-01 -1.6099e-03  1.9252e-02  8.1149e-01
phetchaburi               2.0916e-01 -3.2583e-03  3.8899e-02  1.0770e+00
phichit                   4.2294e-01 -6.5249e-03  7.7644e-02  1.5412e+00
phitsanulok               2.7428e-01 -3.1271e-03  3.7339e-02  1.4356e+00
phra nakhon si ayutthaya -1.6614e-01 -1.2279e-03  1.4690e-02 -1.3607e+00
phrae                     2.1244e-03 -7.5247e-07  9.0130e-06  7.0786e-01
phuket                   -4.1883e-02 -1.5322e-03  1.8324e-02 -2.9809e-01
prachin buri             -3.0731e-02 -1.8865e-04  2.2592e-03 -6.4259e-01
prachuap khiri khan       2.6588e-01 -6.5595e-03  7.8053e-02  9.7517e-01
ranong                   -1.2858e-01 -7.7736e-03  9.2387e-02 -3.9745e-01
ratchaburi                1.6448e-01 -1.9390e-03  2.3179e-02  1.0931e+00
rayong                    1.5835e+00 -2.0765e-02  2.4355e-01  3.2507e+00
roi et                   -4.0143e-03 -3.9461e-04  4.7247e-03 -5.2661e-02
sa kaeo                  -5.2528e-02 -6.7452e-04  8.0738e-03 -5.7708e-01
sakon nakhon              1.1461e-02 -2.3126e-03  2.7636e-02  8.2856e-02
samut prakan              3.0046e-01 -1.0175e-03  1.2175e-02  2.7322e+00
samut sakhon             -8.1514e-01 -1.3901e-02  1.6419e-01 -1.9774e+00
samut songkhram          -6.1790e-01 -1.1864e-02  1.4042e-01 -1.6173e+00
saraburi                  3.5260e-01 -7.4512e-03  8.8584e-02  1.2097e+00
satun                    -6.1398e-02 -1.2343e-03  1.4765e-02 -4.9512e-01
si sa ket                 4.9111e-01 -1.1247e-02  1.3319e-01  1.3765e+00
sing buri                 5.1143e-01 -1.0966e-02  1.2991e-01  1.4494e+00
songkhla                 -7.3629e-01 -2.3888e-02  2.7929e-01 -1.3480e+00
sukhothai                 2.6192e-01 -8.7524e-03  1.0392e-01  8.3964e-01
suphan buri               2.0928e-01 -2.3278e-03  2.7817e-02  1.2687e+00
surat thani              -1.0608e-01 -1.1232e-02  1.3303e-01 -2.6004e-01
surin                     8.7234e-02 -2.8948e-04  3.4663e-03  1.4866e+00
tak                       2.7476e-01 -2.7806e-03  3.3213e-02  1.5229e+00
trang                    -6.9327e-02 -1.1244e-03  1.3453e-02 -5.8803e-01
trat                     -4.7414e-01 -7.7935e-03  9.2621e-02 -1.5323e+00
ubon ratchathani          5.4950e-01 -6.8357e-02  7.6280e-01  7.0743e-01
udon thani               -1.6837e-02 -9.7766e-04  1.1699e-02 -1.4663e-01
uthai thani               4.8373e-01 -9.0350e-03  1.0724e-01  1.5047e+00
uttaradit                 1.7337e-01 -5.0822e-03  6.0564e-02  7.2514e-01
yala                      1.5525e-01 -1.1472e-02  1.3584e-01  4.5237e-01
yasothon                  9.7169e-02 -3.9371e-04  4.7140e-03  1.4210e+00
                         Pr.z....E.Ii..
amnat charoen                    0.1349
ang thong                        0.1448
bangkok                          0.5742
bueng kan                        0.5792
buri ram                         0.4332
chachoengsao                     0.0001
chai nat                         0.0963
chaiyaphum                       0.8245
chanthaburi                      0.1862
chiang mai                       0.9680
chiang rai                       0.4166
chon buri                        0.0020
chumphon                         0.9058
kalasin                          0.7498
kamphaeng phet                   0.0949
kanchanaburi                     0.3072
khon kaen                        0.8800
krabi                            0.6274
lampang                          0.8605
lamphun                          0.9980
loei                             0.3814
lop buri                         0.1001
mae hong son                     0.2151
maha sarakham                    0.3774
mukdahan                         0.8763
nakhon nayok                     0.0764
nakhon pathom                    0.2957
nakhon phanom                    0.9089
nakhon ratchasima                0.8800
nakhon sawan                     0.0864
nakhon si thammarat              0.4516
nan                              0.9990
narathiwat                       0.5417
nong bua lam phu                 0.4784
nong khai                        0.4528
nonthaburi                       0.0883
pathum thani                     0.0484
pattani                          0.5268
phangnga                         0.6866
phatthalung                      0.4706
phayao                           0.3020
phetchabun                       0.4171
phetchaburi                      0.2815
phichit                          0.1233
phitsanulok                      0.1511
phra nakhon si ayutthaya         0.1736
phrae                            0.4790
phuket                           0.7656
prachin buri                     0.5205
prachuap khiri khan              0.3295
ranong                           0.6910
ratchaburi                       0.2744
rayong                           0.0012
roi et                           0.9580
sa kaeo                          0.5639
sakon nakhon                     0.9340
samut prakan                     0.0063
samut sakhon                     0.0480
samut songkhram                  0.1058
saraburi                         0.2264
satun                            0.6205
si sa ket                        0.1687
sing buri                        0.1472
songkhla                         0.1776
sukhothai                        0.4011
suphan buri                      0.2045
surat thani                      0.7948
surin                            0.1371
tak                              0.1278
trang                            0.5565
trat                             0.1254
ubon ratchathani                 0.4793
udon thani                       0.8834
uthai thani                      0.1324
uttaradit                        0.4684
yala                             0.6510
yasothon                         0.1553</code></pre>
</div>
</div>
</section>
<section id="mapping-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="mapping-local-morans-i">7.2.2 Mapping local Moran’s I</h3>
<section id="append-to-local-morans-i-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="append-to-local-morans-i-dataframe">Append to local Moran’s I dataframe</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>thailand.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand,localMI) <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualising-local-morans-i-statistic-values-and-p-values" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-morans-i-statistic-values-and-p-values">Visualising local Moran’s I statistic values and p-values</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>localMI_statistic.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.localMI) <span class="sc">+</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I statistic"</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"local Moran's I statistic"</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>localMI_pvalues.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.localMI) <span class="sc">+</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"local Moran's I p-values"</span>,</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI_statistic.map, localMI_pvalues.map, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "Ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="creating-lisa-cluster-map" class="level3">
<h3 class="anchored" data-anchor-id="creating-lisa-cluster-map">7.3 Creating LISA Cluster Map</h3>
</section>
<section id="plotting-moran-scatterplot" class="level3">
<h3 class="anchored" data-anchor-id="plotting-moran-scatterplot">7.3.1 Plotting Moran scatterplot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>nci <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(thailand<span class="sc">$</span>total_cases, knn8_lw,                   </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">as.character</span>(thailand<span class="sc">$</span>ADM1_EN),                    </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">"Total Cases over all years"</span>,                    </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab=</span><span class="st">"Spatially Lag Total Cases over all years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What can infer from this plot?</p>
<ul>
<li><p>Provinces in the high-high quadrant: Chachoengsao, Chon Buri, Ubon ratchathani. This suggests that there is positive autocorrelation and there is a high cluster among high neighbours.</p></li>
<li><p>Provinces in the High-Low quadrant: Chiang Mai, Nakhon si thammarat, and Bangkok. Meaning that there is negative autocorrelation and these provinces are the high outliers among the low neighbours.</p></li>
</ul>
</section>
<section id="plotting-moran-scatterplot-with-standardized-variable" class="level3">
<h3 class="anchored" data-anchor-id="plotting-moran-scatterplot-with-standardized-variable">7.3.2 Plotting Moran scatterplot with standardized variable</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>thailand<span class="sc">$</span>Z.total_cases<span class="ot">&lt;-</span> <span class="fu">scale</span>(thailand<span class="sc">$</span>total_cases) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  as.vector </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>nci2 <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(thailand<span class="sc">$</span>total_cases, knn8_lw,                   </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">as.character</span>(thailand<span class="sc">$</span>ADM1_EN),                    </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">"z- Total Cases over all years"</span>,                    </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab=</span><span class="st">"Spatially Lag z- Total Cases over all years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lisa-map-classes" class="level3">
<h3 class="anchored" data-anchor-id="lisa-map-classes">7.3.3 LISA map classes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="fu">nrow</span>(localMI))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>thailand<span class="sc">$</span>lag_total_cases <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(knn8_lw, thailand<span class="sc">$</span>total_cases)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> thailand<span class="sc">$</span>lag_total_cases <span class="sc">-</span> <span class="fu">mean</span>(thailand<span class="sc">$</span>lag_total_cases)    </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> localMI[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI[,<span class="dv">1</span>])    </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span>       </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span>     </span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-lisa-map" class="level3">
<h3 class="anchored" data-anchor-id="plotting-lisa-map">7.3.4 <strong>Plotting LISA map</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-width: 12</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-height: 10</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>total_cases <span class="ot">&lt;-</span> <span class="fu">qtm</span>(thailand, <span class="st">"total_cases"</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>thailand.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>LISAmap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.localMI) <span class="sc">+</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(total_cases, LISAmap, </span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>outliers_hotspots <span class="ot">&lt;-</span> thailand.localMI <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(quadrant <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    quadrant <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Low-Low (Hotspot)"</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    quadrant <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Low-High (Outlier)"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    quadrant <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"High-Low (Outlier)"</span>,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    quadrant <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"High-High (Hotspot)"</span>,</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Insignificant"</span>  <span class="co"># Just a fallback, should not occur</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(outliers_hotspots[, <span class="fu">c</span>(<span class="st">"ADM1_EN"</span>, <span class="st">"quadrant"</span>, <span class="st">"cluster"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 611104.4 ymin: 1383501 xmax: 823915.5 ymax: 1579076
Projected CRS: WGS 84 / UTM zone 47N
        ADM1_EN quadrant             cluster                       geometry
2  samut prakan        4 High-High (Hotspot) MULTIPOLYGON (((687139.8 15...
4  pathum thani        2  Low-High (Outlier) MULTIPOLYGON (((704086 1575...
11    chon buri        4 High-High (Hotspot) MULTIPOLYGON (((714273.8 13...
12       rayong        4 High-High (Hotspot) MULTIPOLYGON (((765405.7 13...
15 chachoengsao        4 High-High (Hotspot) MULTIPOLYGON (((722656.1 15...
60 samut sakhon        2  Low-High (Outlier) MULTIPOLYGON (((641549.1 15...</code></pre>
</div>
</div>
<p>We can infer that the outliers lie in the low-high quadrant and high-low quadrants, but there are high-low provinces which are considered outliers, but there are no high-low provinces that are considered significant. However, for the low-high quadrants, the provinces that are the outliers are: Pathum Thani, and Samut Sakhon.</p>
</section>
<section id="computing-gi-statistics-total-cases-over-the-years" class="level3">
<h3 class="anchored" data-anchor-id="computing-gi-statistics-total-cases-over-the-years">7.4 Computing Gi Statistics (total cases over the years)</h3>
<p>Next, we need to perform Gi Statistics, for each fixed distance and adaptive distances. The computed Gi statistic will give us a representation of a Z-score. Greater <u><strong>local Gi</strong></u> represent a greater intensity of <strong>clustering</strong> and the direction (positive or negative) indicates <strong>high or low clusters.</strong></p>
</section>
<section id="gi-statistics-for-adaptive-distance" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance">7.4.1 Gi statistics for adaptive distance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(thailand<span class="sc">$</span>ADM1_EN) </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>gi.adaptive <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand<span class="sc">$</span>total_cases, knn8_lw) </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>thailand.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand, <span class="fu">as.matrix</span>(gi.adaptive)) <span class="sc">%&gt;%</span>   </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.adaptive.)  </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the threshold for hotspot areas (e.g., top 5% of Gi scores) </span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> thailand.gi <span class="sc">%&gt;%</span>   </span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore <span class="ot">&lt;-</span> hotspots <span class="sc">%&gt;%</span>   </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 656299 ymin: 1383501 xmax: 823915.5 ymax: 1546103
Projected CRS: WGS 84 / UTM zone 47N
       ADM1_EN gstat_adaptive                       geometry
1 chachoengsao       3.814500 MULTIPOLYGON (((722656.1 15...
2       rayong       3.250682 MULTIPOLYGON (((765405.7 13...
3    chon buri       3.091608 MULTIPOLYGON (((714273.8 13...
4 samut prakan       2.732226 MULTIPOLYGON (((687139.8 15...</code></pre>
</div>
</div>
</section>
<section id="plotting-and-mapping-gi-values-with-adaptive-distance-weights" class="level3">
<h3 class="anchored" data-anchor-id="plotting-and-mapping-gi-values-with-adaptive-distance-weights">7.4.2 Plotting and Mapping Gi values with adaptive distance weights</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>Gimap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi) <span class="sc">+</span>    </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-RdBu"</span>,            </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Gi"</span>) <span class="sc">+</span>    </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots) <span class="sc">+</span>    </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col=</span><span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi map showing hotspots"</span>,     </span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,   <span class="co"># Reduce the text size     </span></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)     </span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>Gimap </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Similarly, what inference can we draw from the adaptive-based plot?</p>
<ul>
<li><p>There are two hotspots (red), with both hotspots found around the center of thailand comprising of 4 provinces (chachoengsao, rayong, chon buri, and samut prakan), with about gstat_adaptive score of about 2.74 to 3.82.</p></li>
<li><p>Although, outside the scope of this take-home exercise 2, it can be greatly inferred that there is 3 clusters of coldspots, one huge coldspot situated near the north-west area, one in the center, and one in the south.</p></li>
</ul></li>
</ul>
</section>
<section id="computing-gi-statistics-total-cases-across-the-years" class="level3">
<h3 class="anchored" data-anchor-id="computing-gi-statistics-total-cases-across-the-years">7.5 Computing Gi Statistics (total cases across the years)</h3>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2017" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2017">7.5.1 Gi statistics for adaptive distance (year 2017)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2017</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>total_cases_2017 <span class="ot">&lt;-</span> <span class="st">"no_cases_2017"</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2017 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand<span class="sc">$</span>no_cases_2017, knn8_lw) </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the results and create a new column for gstat_adaptive</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>thailand.gi_2017 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2017)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the threshold for hotspot areas (e.g., top 5% of Gi scores) </span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>threshold_2017 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2017<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>hotspots_2017 <span class="ot">&lt;-</span> thailand.gi_2017 <span class="sc">%&gt;%</span>   </span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2017)</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2017 <span class="ot">&lt;-</span> hotspots_2017 <span class="sc">%&gt;%</span>   </span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 656299 ymin: 1383501 xmax: 823915.5 ymax: 1546103
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN      gstat_adaptive                                           geometry
  &lt;chr&gt;        &lt;localG&gt;                                       &lt;MULTIPOLYGON [m]&gt;
1 chachoengsao 4.505097       (((722656.1 1546054, 722796 1546041, 722836 15460…
2 chon buri    4.113471       (((714273.8 1385186, 714348.4 1385113, 714436.2 1…
3 rayong       3.823145       (((765405.7 1384859, 765416.5 1384858, 765428.4 1…
4 samut prakan 3.245631       (((687139.8 1517113, 687147.1 1517078, 687216.9 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2017</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>Gimap_2017 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2017) <span class="sc">+</span>    </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2017"</span>) <span class="sc">+</span>    </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2017) <span class="sc">+</span>    </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi Map Showing Hotspots - 2017"</span>,     </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,     </span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>Gimap_2017</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2018" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2018">7.5.2 Gi statistics for adaptive distance (year 2018)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2018</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>total_cases_2018 <span class="ot">&lt;-</span> <span class="st">"no_cases_2018"</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2018 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand[[total_cases_2018]], knn8_lw) </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>thailand.gi_2018 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2018)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>threshold_2018 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2018<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>hotspots_2018 <span class="ot">&lt;-</span> thailand.gi_2018 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2018)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2018 <span class="ot">&lt;-</span> hotspots_2018 <span class="sc">%&gt;%</span>   </span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2018)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 656299 ymin: 1383501 xmax: 823915.5 ymax: 1546103
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN      gstat_adaptive                                           geometry
  &lt;chr&gt;        &lt;localG&gt;                                       &lt;MULTIPOLYGON [m]&gt;
1 chachoengsao 4.426993       (((722656.1 1546054, 722796 1546041, 722836 15460…
2 rayong       3.840999       (((765405.7 1384859, 765416.5 1384858, 765428.4 1…
3 chon buri    3.707734       (((714273.8 1385186, 714348.4 1385113, 714436.2 1…
4 samut prakan 3.645930       (((687139.8 1517113, 687147.1 1517078, 687216.9 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2018</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>Gimap_2018 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2018) <span class="sc">+</span>    </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2018"</span>) <span class="sc">+</span>    </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2018) <span class="sc">+</span>    </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi map showing hotspots"</span>,     </span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,   <span class="co"># Reduce the text size     </span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>Gimap_2018</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2019" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2019">7.5.3 Gi statistics for adaptive distance (year 2019)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2019</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>total_cases_2019 <span class="ot">&lt;-</span> <span class="st">"no_cases_2019"</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2019 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand[[total_cases_2019]], knn8_lw) </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>thailand.gi_2019 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2019)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>threshold_2019 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2019<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>hotspots_2019 <span class="ot">&lt;-</span> thailand.gi_2019 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2019)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2019 <span class="ot">&lt;-</span> hotspots_2019 <span class="sc">%&gt;%</span>   </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 656299 ymin: 1383501 xmax: 823915.5 ymax: 1546103
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN      gstat_adaptive                                           geometry
  &lt;chr&gt;        &lt;localG&gt;                                       &lt;MULTIPOLYGON [m]&gt;
1 chachoengsao 4.042047       (((722656.1 1546054, 722796 1546041, 722836 15460…
2 rayong       3.608801       (((765405.7 1384859, 765416.5 1384858, 765428.4 1…
3 samut prakan 3.254957       (((687139.8 1517113, 687147.1 1517078, 687216.9 1…
4 chon buri    3.203903       (((714273.8 1385186, 714348.4 1385113, 714436.2 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2019</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>Gimap_2019 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2019) <span class="sc">+</span>    </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2019"</span>) <span class="sc">+</span>    </span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2019) <span class="sc">+</span>    </span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi Map Showing Hotspots - 2019"</span>,     </span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,     </span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>Gimap_2019</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2020" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2020">7.5.4 Gi statistics for adaptive distance (year 2020)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2020</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>total_cases_2020 <span class="ot">&lt;-</span> <span class="st">"no_cases_2020"</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2020 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand[[total_cases_2020]], knn8_lw) </span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>thailand.gi_2020 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2020)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>threshold_2020 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2020<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>hotspots_2020 <span class="ot">&lt;-</span> thailand.gi_2020 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2020)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2020 <span class="ot">&lt;-</span> hotspots_2020 <span class="sc">%&gt;%</span>   </span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 656299 ymin: 1383501 xmax: 823915.5 ymax: 1546103
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN      gstat_adaptive                                           geometry
  &lt;chr&gt;        &lt;localG&gt;                                       &lt;MULTIPOLYGON [m]&gt;
1 chachoengsao 4.120156       (((722656.1 1546054, 722796 1546041, 722836 15460…
2 rayong       3.598405       (((765405.7 1384859, 765416.5 1384858, 765428.4 1…
3 chon buri    3.326998       (((714273.8 1385186, 714348.4 1385113, 714436.2 1…
4 samut prakan 2.806983       (((687139.8 1517113, 687147.1 1517078, 687216.9 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2020</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>Gimap_2020 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2020) <span class="sc">+</span>    </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2020"</span>) <span class="sc">+</span>    </span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2020) <span class="sc">+</span>    </span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi Map Showing Hotspots - 2020"</span>,     </span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,     </span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>Gimap_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2021" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2021">7.5.5 Gi statistics for adaptive distance (year 2021)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2021</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>total_cases_2021 <span class="ot">&lt;-</span> <span class="st">"no_cases_2021"</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2021 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand[[total_cases_2021]], knn8_lw) </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>thailand.gi_2021 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2021)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>threshold_2021 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2021<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>hotspots_2021 <span class="ot">&lt;-</span> thailand.gi_2021 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2021)</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2021 <span class="ot">&lt;-</span> hotspots_2021 <span class="sc">%&gt;%</span>   </span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2021)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 700080.9 ymin: 1458481 xmax: 1149111 ymax: 1815185
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN       gstat_adaptive                                          geometry
  &lt;chr&gt;         &lt;localG&gt;                                      &lt;MULTIPOLYGON [m]&gt;
1 amnat charoen 2.393368       (((1137720 1809629, 1137724 1809622, 1137729 180…
2 surin         2.369772       (((943717.1 1715508, 943794.7 1715487, 943848.6 …
3 yasothon      2.205012       (((1076954 1815140, 1077293 1814998, 1077477 181…
4 chachoengsao  1.960467       (((722656.1 1546054, 722796 1546041, 722836 1546…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2021</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>Gimap_2021 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2021) <span class="sc">+</span>    </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2021"</span>) <span class="sc">+</span>    </span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2021) <span class="sc">+</span>    </span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi Map Showing Hotspots - 2021"</span>,     </span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,     </span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>Gimap_2021</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gi-statistics-for-adaptive-distance-year-2022" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-adaptive-distance-year-2022">7.5.6 Gi statistics for adaptive distance (year 2022)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2022</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>total_cases_2022 <span class="ot">&lt;-</span> <span class="st">"no_cases_2022"</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>gi.adaptive_2022 <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand[[total_cases_2022]], knn8_lw) </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>thailand.gi_2022 <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> </span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gstat_adaptive =</span> gi.adaptive_2022)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>threshold_2022 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(thailand.gi_2022<span class="sc">$</span>gstat_adaptive, <span class="fl">0.95</span>)    </span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>hotspots_2022 <span class="ot">&lt;-</span> thailand.gi_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gstat_adaptive <span class="sc">&gt;=</span> threshold_2022)</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>hotspots_province_gstatscore_2022 <span class="ot">&lt;-</span> hotspots_2022 <span class="sc">%&gt;%</span>   </span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, gstat_adaptive) <span class="sc">%&gt;%</span>   </span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gstat_adaptive))   </span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hotspots_province_gstatscore_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 793274.7 ymin: 1726041 xmax: 1149111 ymax: 2005950
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 4 × 3
  ADM1_EN          gstat_adaptive                                       geometry
  &lt;chr&gt;            &lt;localG&gt;                                   &lt;MULTIPOLYGON [m]&gt;
1 nong bua lam phu 3.288733       (((848689.2 1959160, 848690 1959158, 848690.3…
2 sakon nakhon     2.564716       (((980884.2 2003610, 980891.9 2003594, 980899…
3 amnat charoen    2.531778       (((1137720 1809629, 1137724 1809622, 1137729 …
4 khon kaen        2.529988       (((894655.6 1892949, 894734.5 1892936, 894904…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map for 2022</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>Gimap_2022 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand.gi_2022) <span class="sc">+</span>    </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,            </span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,            </span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-RdBu"</span>,            </span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi - 2022"</span>) <span class="sc">+</span>    </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>   </span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hotspots_2022) <span class="sc">+</span>    </span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span>    </span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(     </span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Gi Map Showing Hotspots - 2022"</span>,     </span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,     </span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,     </span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">TRUE</span>,     </span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,     </span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>Gimap_2022</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home_Ex02_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-of-results" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-results">7.5.7 Interpretation of results</h3>
<p>We can see the hotspots remain around the same area (around the center) from 2017-2020, but changes towards the north-east area (2022: nong bua lam phu, sakon nakhon, amnat charoen, khon kaen). This shows that the hotspots depicting the highest drug cases changed from the center area to north-east area.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>